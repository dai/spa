(function(f){f.fn.spa=f.fn.spa||function(){var j,k,l,m={404:"<h1>404 Page not found</h1>"},n={},g={},q={},r={},i=[],h=!1,s=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a=a.replace(RegExp("{{"+d+"}}","g"),b[d]));return a},o=function(a,b,d){var c=m[a],e,b=b||{},d=d||{};d.cache&&(e=!0===d.cache?a:a+"-"+d.cache);if(d.cache&&n.hasOwnProperty(e))b=n[e],h&&console.log("(SPA) views cache hit: "+e);else if(c)if(b=s(c,b))b='<div id="spa__wrap">'+b+"</div>",h&&console.log("(SPA) views cache miss: "+a),
d.cache&&(n[e]=b);else throw Error("(SPA) template could not be rendered >> "+a);else throw Error("(SPA) template does not exist >> "+a);j.empty().html(b)},p=function(){var a=window.location.hash,b,d,c,e;if(a!==l){l=a;if(a.match(/^$|^#(?!\!).+/))b=i.slice(-1)[0];else if(a.match(/^\#\!.+/))for(e=0;e<i.length&&!b;e++)d=RegExp(i[e].url),d.test(a.slice(2))&&(b=i[e]);if(a=b){b=q[a.controller];d=a.action||"handler";c=b[d];var f=l||window.location.hash;e={};var g;if(f.match(/^\#\!/))for(f=f.substr(3).split("/");0!=
f.length;)g=f.splice(0,2),e[g[0]]=g[1];c=c(e,k);k=e;c?(b.beforeRender&&(h&&console.log("(SPA) executing beforeRender callback"),b.beforeRender(c,d)),e=a.controller,c.options&&c.options.template?(e=c.options.template,delete c.options.template):a.action&&(e+="__"+a.action),o(e,c.data,c.options),b.afterRender&&(h&&console.log("(SPA) executing afterRender callback"),b.afterRender(c,d)),window.scrollTo(0,0)):o("404",null,{cache:!0})}else o("404",null,{cache:!0})}};j=this;if(!j.length)throw Error("(SPA) container does not exist");
f("script[type='text/html']").map(function(a,b){var d=f(b),c=d.attr("id");"spa__"===c.substr(0,5)&&(c=c.substring(5));m[c]=d.html()});return{cache:function(a,b,d,c){"undefined"===typeof c&&(c=!0);g.hasOwnProperty(a)||(g[a]={});if(c)return(c=g[a][b])?h&&console.log("(SPA) objects cache hit: "+a+":"+b):(c=g[a][b]=d(b),h&&console.log("(SPA) objects cache miss: "+a+":"+b)),c;delete g[a][b];return d(b)},run:function(){"onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode)?f(window).bind("hashchange",
p):setInterval(p,333);p()},getParams:function(){return k},addHelpers:function(a){f.extend(r,a)},helpers:function(){return r},templates:function(a){return m[a]},addControllers:function(a){f.extend(q,a)},addRoutes:function(a){f.merge(i,a)},setRenderer:function(a){f.isFunction(a)&&(s=a)},setDebug:function(a){h=a}}}})(jQuery);